# Experiment No. 5

## FOR QUERIES :
https://github.com/Manishabro/dbms/blob/main/1.md#queries


## TABLE CREATION 

```sql
CREATE TABLE DEPARTMENT (DNO VARCHAR (20) PRIMARY KEY, DNAME VARCHAR (20), MGRSTARTDATE DATE);

CREATE TABLE EMPLOYEE
(SSN VARCHAR (20) PRIMARY KEY, FNAME VARCHAR (20),
LNAME VARCHAR (20),
ADDRESS VARCHAR (20),
SEX CHAR (1), SALARY INTEGER,
SUPERSSN VARCHAR(2),
FOREIGN KEY(SUPERSSN) REFERENCES EMPLOYEE (SSN), DNO VARCHAR(2),
FOREIGN KEY (DNO) REFERENCES DEPARTMENT (DNO));

NOTE: Once DEPARTMENT and EMPLOYEE tables are created we must alter department table to add foreign constraint MGRSSN using sql command

ALTER TABLE DEPARTMENT ADD MGRSSN VARCHAR(20);

ALTER TABLE DEPARTMENT
ADD FOREIGN KEY(MGRSSN) REFERENCES EMPLOYEE (SSN);

CREATE TABLE DLOCATION (DLOC VARCHAR (20),
DNO VARCHAR(2),
FOREIGN KEY(DNO) REFERENCES DEPARTMENT (DNO), PRIMARY KEY (DNO, DLOC));

CREATE TABLE PROJECT (PNO INTEGER PRIMARY KEY, PNAME VARCHAR (20),
PLOCATION VARCHAR (20), DNO VARCHAR(2),
FOREIGN KEY(DNO) REFERENCES DEPARTMENT (DNO));
 
CREATE TABLE WORKS_ON (HOURS INT (2),
SSN VARCHAR(20),
FOREIGN KEY(SSN) REFERENCES EMPLOYEE (SSN), PNO INTEGER,
FOREIGN KEY (PNO) REFERENCES PROJECT(PNO),
PRIMARY KEY (SSN, PNO));


```

##  RECORD INSERTION 

```sql



INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVECE01','JOHN','SCOTT','BANGALORE','M', 450000);
INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVCSE01','JAMES','SMITH','BANGALORE','M', 500000);
INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVCSE02','HEARN','BAKER','BANGALORE','M', 700000);
INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVCSE03','EDWARD','SCOTT','MYSORE','M', 500000);
INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVCSE04','PAVAN','HEGDE','MANGALORE','M', 650000);
INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVCSE05','GIRISH','MALYA','MYSORE','M', 450000);
INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVCSE06','NEHA','SN','BANGALORE','F', 800000);
INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVACC01','AHANA','K','MANGALORE','F', 350000);
INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVACC02','SANTHOSH','KUMAR','MANGALORE','M', 300000); INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVISE01','VEENA','M','MYSORE','M', 600000);
INSERT INTO EMPLOYEE (SSN, FNAME, LNAME, ADDRESS, SEX, SALARY) VALUES ('SMVIT01','NAGESH','HR','BANGALORE','M', 500000);


INSERT INTO DEPARTMENT VALUES ('1','ACCOUNTS','2001-01-01','SMVACC02'); INSERT INTO DEPARTMENT VALUES ('2','IT','2016-08-01','SMVIT01');
INSERT INTO DEPARTMENT VALUES ('3','ECE','2008-06-01','SMVECE01'); INSERT INTO DEPARTMENT VALUES ('4','ISE','2015-08-01','SMVISE01'); INSERT INTO DEPARTMENT VALUES ('5','CSE','2002-06-02','SMVCSE05');
Note: update entries of employee table to fill missing fields SUPERSSN and DNO UPDATE EMPLOYEE SET
SUPERSSN=NULL, DNO='3'
WHERE SSN='SMVECE01';

UPDATE EMPLOYEE SET SUPERSSN='SMVCSE02', DNO='5' WHERE SSN='SMVCSE01';

UPDATE EMPLOYEE SET SUPERSSN='SMVCSE03', DNO='5' WHERE SSN='SMVCSE02';

UPDATE EMPLOYEE SET SUPERSSN='SMVCSE04', DNO='5'
WHERE SSN='SMVCSE03';

UPDATE EMPLOYEE SET DNO='5', SUPERSSN='SMVCSE05' WHERE SSN='SMVCSE04';

UPDATE EMPLOYEE SET DNO='5', SUPERSSN='SMVCSE06' WHERE SSN='SMVCSE05';

UPDATE EMPLOYEE SET DNO='5', SUPERSSN=NULL WHERE SSN='SMVCSE06';

UPDATE EMPLOYEE SET DNO='1', SUPERSSN='SMVACC02' WHERE SSN='SMVACC01';

UPDATE EMPLOYEE SET DNO='1', SUPERSSN=NULL WHERE SSN='SMVACC02';

UPDATE EMPLOYEE SET DNO='4', SUPERSSN=NULL WHERE SSN='SMVISE01';

UPDATE EMPLOYEE SET DNO='2', SUPERSSN=NULL WHERE SSN='SMVIT01';

INSERT INTO DLOCATION VALUES ('BANGALORE', '1'); 
INSERT INTO DLOCATION VALUES ('BANGALORE', '2'); 
INSERT INTO DLOCATION VALUES ('BANGALORE', '3'); 
INSERT INTO DLOCATION VALUES ('MANGALORE', '4'); 
INSERT INTO DLOCATION VALUES ('MANGALORE', '5');


INSERT INTO PROJECT VALUES (100,'IOT','BANGALORE','5'); 
INSERT INTO PROJECT VALUES (101,'CLOUD','BANGALORE','5');
 INSERT INTO PROJECT VALUES (102,'BIGDATA','BANGALORE','5'); 
INSERT INTO PROJECT VALUES (103,'SENSORS','BANGALORE','3');
INSERT INTO PROJECT VALUES (104,'BANK MANAGEMENT','BANGALORE','1'); INSERT INTO PROJECT VALUES (105,'SALARY MANAGEMENT','BANGALORE','1'); 
INSERT INTO PROJECT VALUES (106,'OPENSTACK','BANGALORE','4');
INSERT INTO PROJECT VALUES (107,'SMART CITY','BANGALORE','2');

INSERT INTO WORKS_ON VALUES (4, 'SMVCSE01', 100); 
INSERT INTO WORKS_ON VALUES (6, 'SMVCSE01', 101); 
INSERT INTO WORKS_ON VALUES (8, 'SMVCSE01', 102); 
INSERT INTO WORKS_ON VALUES (10, 'SMVCSE02', 100);
INSERT INTO WORKS_ON VALUES (3, 'SMVCSE04', 100);
 INSERT INTO WORKS_ON VALUES (4, 'SMVCSE05', 101); INSERT INTO WORKS_ON VALUES (5, 'SMVCSE06', 102); 
INSERT INTO WORKS_ON VALUES (6, 'SMVCSE03', 102); 
INSERT INTO WORKS_ON VALUES (7, 'SMVECE01', 103);
 INSERT INTO WORKS_ON VALUES (5, 'SMVACC01', 104);
 INSERT INTO WORKS_ON VALUES (6, 'SMVACC02', 105); 
INSERT INTO WORKS_ON VALUES (4, 'SMVISE01', 106);
 INSERT INTO WORKS_ON VALUES (10, 'SMVIT01', 107);

```

## QUERIES




## Make a list of all project numbers for projects that involve an employee whose last name is ‘Scott’, either as a worker or as a manager of the department that controls the project.
   
```sql
(SELECT DISTINCT P.PNO
FROM PROJECT P, DEPARTMENT D, EMPLOYEE E WHERE E.DNO=D.DNO
AND D.MGRSSN=E.SSN AND E.LNAME=’SCOTT’) UNION
(SELECT DISTINCT P1.PNO
FROM PROJECT P1, WORKS_ON W, EMPLOYEE E1 WHERE P1.PNO=W.PNO
AND E1.SSN=W.SSN
AND E1.LNAME=’SCOTT’);


```

## Show the resulting salaries if every employee working on the ‘IoT’ project is given a 10 percent raise.
   
```sql
SELECT E.FNAME, E.LNAME, 1.1*E.SALARY AS INCR_SAL FROM EMPLOYEE E, WORKS_ON W, PROJECT P
WHERE E.SSN=W.SSN AND W.PNO=P.PNO AND P.PNAME=’IOT’;


```

## Find the sum of the salaries of all employees of the ‘Accounts’ department, as well as the maximum salary, the minimum salary, and the average salary in this department
   
```sql
SELECT SUM (E.SALARY), MAX (E.SALARY), MIN (E.SALARY), AVG (E.SALARY) FROM EMPLOYEE E, DEPARTMENT D
WHERE E.DNO=D.DNO
AND D.DNAME=’ACCOUNTS’;

```

## Retrieve the name of each employee who works on all the projects Controlled by department number 5 (use NOT EXISTS operator).


```sql
SELECT E.FNAME, E.LNAME FROM EMPLOYEE E
WHERE NOT EXISTS(SELECT P.PNO FROM PROJECT P
WHERE DNO='5' AND P.PNO NOT IN (SELECT W.PNO FROM WORKS_ON W WHERE E.SSN=W.SSN));

OR
UPDATE IAMARKS SET FINALIA=NULL;
UPDATE IAMARKS SET FINALIA=((TEST1+TEST2+TEST3)-LEAST(TEST1,TEST2,TEST3))/2;
```

## For each department that has more than five employees, retrieve the department number and the number of its employees who are making more than Rs. 6, 00,000.
   
```sql
SELECT D.DNO, COUNT(*)
FROM DEPARTMENT D, EMPLOYEE E WHERE D.DNO=E.DNO
AND E.SALARY>600000
AND D.DNO IN (SELECT E1.DNO FROM EMPLOYEE E1
GROUP BY E1.DNO HAVING COUNT(*)>5) ;


```
